id: detect-dangling-cname
info:
  name: CNAME Detect Dangling
  author: pdteam,nytr0gen
  severity: info
  description: The "CNAME Detect Dangling" vulnerability occurs when a Canonical Name
    (CNAME) record in the Domain Name System (DNS) points to a resource that no longer
    exists or is not actively maintained. This situation, known as a "dangling CNAME,"
    can be exploited by an attacker to gain control over the affected domain, potentially
    compromising the confidentiality, integrity, and availability of the system. Attackers
    may leverage the dangling CNAME to redirect users to a malicious site, launch
    phishing attacks, host malware, or even gain unauthorized access to the system,
    leading to further escalation of privileges. Additionally, the presence of a dangling
    CNAME can result in service disruptions, as users may be unable to access the
    intended resource. To mitigate this vulnerability, it is crucial to implement
    a robust process for regularly reviewing and maintaining the organization's DNS
    records, ensuring the timely removal of any dangling CNAME entries and establishing
    clear policies and procedures for proper DNS management.
  reference:
  - https://securitytrails.com/blog/subdomain-takeover-tips
  - https://nominetcyber.com/dangling-dns-is-no-laughing-matter/
  - https://nabeelxy.medium.com/dangling-dns-records-are-a-real-vulnerability-361f2a29d37f
  - https://docs.microsoft.com/en-us/azure/security/fundamentals/subdomain-takeover
  classification:
    cwe-id: CWE-200
  metadata:
    max-request: 1
  tags: dns,takeover
  impact: '- An attacker could potentially take over the dangling CNAME record and
    redirect users to a malicious site, compromising the confidentiality, integrity,
    and availability of the system.

    - The attacker could use the dangling CNAME to launch phishing attacks, tricking
    users into divulging sensitive information such as login credentials.

    - The attacker could leverage the dangling CNAME to host malware or other malicious
    content, potentially infecting users who access the compromised resource.

    - The attacker could use the dangling CNAME to gain unauthorized access to the
    system, potentially escalating privileges and compromising the entire infrastructure.

    - The dangling CNAME could lead to service disruptions, as users may be unable
    to access the intended resource, affecting the availability of the system.'
  remediation: 'To address the "CNAME Detect Dangling" vulnerability, it is crucial
    to implement a reliable process for regularly reviewing and maintaining the organization''s
    DNS records. This includes identifying and removing any dangling CNAME records
    that are no longer needed or associated with active services.


    - Regularly audit the organization''s DNS zone files to identify any CNAME records
    that are no longer in use or pointing to invalid destinations.

    - Establish a clear process for removing CNAME records when the associated service
    or resource is decommissioned or no longer required.

    - Implement automated monitoring and alerting mechanisms to detect the presence
    of dangling CNAME records, enabling prompt remediation.

    - Ensure that the organization''s DNS management policies and procedures include
    guidelines for the proper handling and removal of CNAME records to prevent the
    introduction of dangling records.

    - Educate developers and IT staff on the importance of properly managing CNAME
    records and the potential risks associated with dangling records.'
dns:
- name: '{{FQDN}}'
  type: A
  matchers-condition: and
  matchers:
  - type: word
    words:
    - NXDOMAIN
  - type: regex
    part: answer
    regex:
    - "IN\tCNAME\t(.+)$"
  extractors:
  - type: dsl
    dsl:
    - cname
